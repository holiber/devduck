
> devduck@0.2.0 test
> tsx scripts/run-tests.ts

Found 21 test files
â–¶ ci: smogcheck-provider
  âœ” matches CIProvider interface (0.640235ms)
  âœ” fetchPR returns PR info that matches PRInfo schema (1.425085ms)
  âœ” fetchPR throws error for non-existent PR (0.142662ms)
  âœ” fetchPR works with branch name (0.242801ms)
  âœ” fetchCheckStatus returns check statuses that match CheckStatus schema (0.365207ms)
  âœ” fetchCheckStatus returns annotations for failed checks (0.13589ms)
  âœ” fetchCheckStatus works with checkId (0.104709ms)
  âœ” fetchCheckStatus works with branch name (0.08966ms)
  âœ” fetchComments returns comments that match Comment schema (0.374919ms)
  âœ” fetchComments includes reactions (0.18161ms)
  âœ” fetchComments includes file location for file comments (0.797294ms)
  âœ” fetchComments works with branch name (0.084548ms)
âœ” ci: smogcheck-provider (5.546522ms)
â–¶ ci: provider registry discovery
  âœ” discovers smogcheck-provider from modules directory and registers it (56.201293ms)
âœ” ci: provider registry discovery (56.27588ms)
âœ” launch dev starts background processes, runs smokecheck, captures browser console, and allows reuse (6379.89933ms)
âœ” workspace.config.json launch.dev starts processes, runs smokecheck, and supports smokecheck without args (5657.057065ms)
âœ” ProcessManager writes stdout/stderr logs (82.930875ms)
âœ” stop kills a process group (parent + child) (101.805988ms)
â–¶ email: gmail-provider
  âœ” matches EmailProvider interface (0.418073ms)
âœ” email: gmail-provider (0.920138ms)
â–¶ email: provider registry discovery (gmail-provider)
  âœ” discovers gmail-provider from modules directory and registers it (31.605637ms)
âœ” email: provider registry discovery (gmail-provider) (31.693183ms)
â–¶ email: smogcheck-provider
  âœ” matches EmailProvider interface (0.520751ms)
  âœ” listUnreadMessages returns messages that match Message schema (1.59674ms)
  âœ” getMessage returns a message by id (0.249896ms)
  âœ” searchMessages supports filtering by from (0.15624ms)
  âœ” searchMessages supports filtering by participant (to/cc/bcc/from) (0.135126ms)
  âœ” searchMessages supports filtering by date range (0.131609ms)
  âœ” downloadAttachment returns a Buffer for an existing attachment (0.195107ms)
âœ” email: smogcheck-provider (3.68548ms)
â–¶ email: provider registry discovery
  âœ” discovers smogcheck-provider from modules directory and registers it (34.002856ms)
âœ” email: provider registry discovery (34.140126ms)
â–¶ install/mcp optional servers
  âœ” marks optional URL-based server failure as non-blocking (13.76419ms)
  âœ” marks optional command-based server failure as non-blocking (5.019964ms)
âœ” install/mcp optional servers (19.385292ms)
â–¶ Install Project Scripts
  âœ” Install default scripts from project (3.141332ms)
  âœ” Install additional scripts via importScripts (1.749781ms)
  âœ” Remove scripts when project is removed from config (2.028648ms)
  âœ” Handle missing project package.json gracefully (0.980605ms)
  âœ” Verify scripts do not change current directory (1.050983ms)
âœ” Install Project Scripts (15.000038ms)
Created shared workspace: /workspace/.cache/temp/install-steps-test-1766884357117
[36m
[Step 1] Checking environment variables...[0m
[33m
  âš  Missing required environment variables:[0m
[33m    - TEST_VAR_1 (config) - Test variable 1[0m
[36m
  â„¹ Please:[0m
[36m    1. Switch to workspace folder: cd /workspace/.cache/temp/install-steps-test-1766884357117[0m
[36m    2. Set missing variables in .env file or environment variables[0m
[36m    3. Re-run installation[0m
[33m  âš  Step 1 requires user input[0m
[36m
[Step 1] Checking environment variables...[0m
[32m  âœ“ All required environment variables are present[0m
[32m  âœ“ Step 1 completed[0m
â–¶ Installation Steps
  âœ” Step 1: Check Environment Variables (25.933948ms)
[36m
[Step 2] Downloading repositories...[0m
[36m  â„¹ No repositories to download[0m
  âœ” Step 2: Download Repos (4.373197ms)
[36m
[Step 3] Downloading projects...[0m
[36m  â„¹ No projects to download[0m
[36m
[Step 4] Checking environment variables again...[0m
[32m  âœ“ All required environment variables are present[0m
[32m  âœ“ Step 4 completed[0m
[36m
[Step 5] Setting up modules...[0m
[36m  â„¹ Executing module hooks...[0m
[32m  âœ“ Step 5 completed[0m
[36m
[Step 6] Setting up projects...[0m
[36m  â„¹ No projects to setup[0m
[36m
[Step 7] Verifying installation...[0m
[36m  â„¹ Verifying 0 check(s)...[0m
[32m  âœ“ All verifications passed (0/0 passed, 0 skipped)[0m
[32m  âœ“ Step 7 completed[0m
  âœ” Step 3: Download Projects (1.794369ms)
  âœ” Step 4: Check Environment Again (6.156264ms)
  âœ” Step 5: Setup Modules (10.908775ms)
  âœ” Step 6: Setup Projects (1.614758ms)
  âœ” Step 7: Verify Installation (8.940091ms)
Cleaned up shared workspace: /workspace/.cache/temp/install-steps-test-1766884357117
âœ” Installation Steps (64.950886ms)
â–¶ Workspace Installer - GUI/Interactive Mode
  â–¶ Fresh Workspace Installation
    âœ” GUI Installation - Fresh Workspace (442.07832ms)
  âœ” Fresh Workspace Installation (442.537959ms)
  â–¶ Existing Workspace Operations
    âœ” Detect Existing Workspace (390.962127ms)
  âœ” Existing Workspace Operations (395.13644ms)
âœ” Workspace Installer - GUI/Interactive Mode (838.027816ms)
âœ” installer: hook load failure is fatal (397.467144ms)
âœ” installer: .env values are available to shell checks (fill-missing) (347.221982ms)
âœ” installer: checks without name do not print "Checking undefined" (351.768809ms)
âœ” installer summary: prints INSTALLATION FINISHED WITH ERRORS on failures (336.451993ms)
â–¶ Workspace Installer - Unattended Mode
  â–¶ Fresh Workspace Installation
    âœ” Unattended Installation from fixture - cursor-only (388.886746ms)
    âœ” Unattended Installation - Fresh Workspace (342.048525ms)
    âœ” Unattended Installation with Config File (338.088476ms)
    âœ” Unattended Installation with workspace.config.json (local folder project src) (447.668617ms)
    âœ” Unattended Installation with workspace.config.json seedFiles[] copies seed files/folders (370.91219ms)
    âœ” Unattended Installation - Full Structure Verification (380.155283ms)
  âœ” Fresh Workspace Installation (2268.498915ms)
  â–¶ Existing Workspace Operations
    âœ” Reinstall Existing Workspace - Unattended (737.065475ms)
    âœ” Add Modules to Existing Workspace (729.97805ms)
    âœ” Remove Modules from Existing Workspace (733.935074ms)
    âœ” Reinstallation Verification - Preserve Configuration (745.099452ms)
    âœ” Reinstallation - Module Hooks Re-executed (723.999374ms)
  âœ” Existing Workspace Operations (3670.438682ms)
  â–¶ External Repository Installation
    âœ” Installation with External Repository (871.649618ms)
  âœ” External Repository Installation (871.77104ms)
âœ” Workspace Installer - Unattended Mode (6811.029738ms)
â–¶ workspace modules patterns
  âœ” modules: ["issue-*"] expands to issue-tracker and issue-tracker-github (16.606626ms)
âœ” workspace modules patterns (17.280971ms)
â–¶ devduck new (npx-friendly bootstrap)
  âœ” clones DevDuck into devduck/src when not listed in projects (3835.000809ms)
  âœ” resolves relative workspace path from INIT_CWD (npx cache cwd simulation) (2696.268814ms)
âœ” devduck new (npx-friendly bootstrap) (6532.13811ms)
â–¶ Workspace Installer - Workspace-local modules/
  âœ” Installs module from workspace/modules when listed in config (417.281241ms)
âœ” Workspace Installer - Workspace-local modules/ (417.961196ms)
â–¶ issue-tracker-github: github-provider
  âœ” matches IssueTrackerProvider contract schema (2.501103ms)
  âœ” fetchIssue returns issue that matches Issue schema (0.11135ms)
  â–¶ fetchIssue works with URL
    ï¹£ GITHUB_TOKEN not set (0.073891ms) # SKIP
  âœ” fetchIssue works with URL (0.251048ms)
  â–¶ fetchIssue throws error for non-existent issue
    ï¹£ GITHUB_TOKEN not set (0.267069ms) # SKIP
  âœ” fetchIssue throws error for non-existent issue (0.392224ms)
  â–¶ fetchComments returns comments that match Comment schema
    ï¹£ GITHUB_TOKEN not set (0.090374ms) # SKIP
  âœ” fetchComments returns comments that match Comment schema (0.23998ms)
  â–¶ fetchPRs returns PR references that match PRReference schema
    ï¹£ GITHUB_TOKEN not set (0.106934ms) # SKIP
  âœ” fetchPRs returns PR references that match PRReference schema (0.304053ms)
  â–¶ downloadResources creates correct directory structure
    ï¹£ GITHUB_TOKEN not set (0.076737ms) # SKIP
  âœ” downloadResources creates correct directory structure (0.229991ms)
  â–¶ downloadResources creates resources.json with correct metadata
    ï¹£ GITHUB_TOKEN not set (0.085883ms) # SKIP
  âœ” downloadResources creates resources.json with correct metadata (0.286628ms)
  â–¶ downloadResources downloads resources with distance <= 1
    ï¹£ GITHUB_TOKEN not set (0.0587ms) # SKIP
  âœ” downloadResources downloads resources with distance <= 1 (0.220552ms)
  â–¶ downloadResources creates issue.json with comments
    ï¹£ GITHUB_TOKEN not set (0.036244ms) # SKIP
  âœ” downloadResources creates issue.json with comments (0.143711ms)
âœ” issue-tracker-github: github-provider (5.394121ms)
â–¶ issue-tracker-github: provider registry discovery
  âœ” discovers github-provider from modules directory and registers it (with schema validation) (28.491597ms)
âœ” issue-tracker-github: provider registry discovery (28.560149ms)
â–¶ issue-tracker: smogcheck-provider
  âœ” matches IssueTrackerProvider contract schema (2.708397ms)
  âœ” fetchIssue returns issue that matches Issue schema (0.534442ms)
  âœ” fetchIssue works with issue key (0.089067ms)
  âœ” fetchIssue works with URL (0.156924ms)
  âœ” fetchIssue throws error for non-existent issue (0.134882ms)
  âœ” fetchComments returns comments that match Comment schema (0.396016ms)
  âœ” fetchComments includes reactions (0.123179ms)
  âœ” fetchComments returns empty array for issue without comments (0.08081ms)
  âœ” fetchPRs returns PR references that match PRReference schema (0.245074ms)
  âœ” fetchPRs returns empty array for issue without PRs (0.144376ms)
  âœ” downloadResources creates correct directory structure (2.095851ms)
  âœ” downloadResources creates resources.json with correct metadata (1.192901ms)
  âœ” downloadResources downloads resources with distance <= 2 (1.142651ms)
  âœ” downloadResources tracks resources with distance == 3 without downloading (1.139862ms)
  âœ” downloadResources creates issue.json with comments and PRs (1.213394ms)
  âœ” downloadResources creates PR directories when PRs exist (0.993496ms)
âœ” issue-tracker: smogcheck-provider (13.461866ms)
â–¶ issue-tracker: provider registry discovery
  âœ” discovers smogcheck-provider from modules directory and registers it (with schema validation) (31.11999ms)
âœ” issue-tracker: provider registry discovery (31.210659ms)
â–¶ mcp: API module
  âœ” mcpRouter is defined and has procedures (0.716069ms)
  âœ” mcpRouter.list procedure exists with correct schema (0.191993ms)
  âœ” mcpRouter.call procedure exists with correct schema (0.202192ms)
  âœ” mcp module is included in unified API (25.751769ms)
  âœ” mcp.list can list servers when mcp.json exists (0.5187ms)
  âœ” npm run api lists mcp methods (0.183595ms)
  âœ” mcp.list can be called via API CLI (0.137856ms)
  âœ” mcp.call can be called via API CLI (help check) (0.153208ms)
âœ” mcp: API module (28.602097ms)
âœ” messenger CLI exposes required inputs as options (974.29653ms)
âœ” ci CLI positional still works (no duplicate required flags) (464.932497ms)
â–¶ messenger: telegram-provider
  âœ” matches MessengerProvider contract schema (1.643337ms)
  âœ” listChats returns chats that match Chat schema (1.377284ms)
  âœ” getChatHistory returns messages that match ChatMessage schema (1.595206ms)
  âœ” downloadFile returns a descriptor that matches DownloadFileResult schema (0.740658ms)
âœ” messenger: telegram-provider (6.075031ms)
â–¶ messenger: yandex-messenger-provider
  âœ” matches MessengerProvider contract schema (1.211315ms)
  âœ” listChats returns chats that match Chat schema (0.600061ms)
  âœ” getChatHistory returns messages that match ChatMessage schema (1.273283ms)
  âœ” downloadFile returns a descriptor that matches DownloadFileResult schema (0.557759ms)
âœ” messenger: yandex-messenger-provider (3.94548ms)
â–¶ messenger: provider registry discovery
  âœ” discovers messenger providers from modules directory and registers them (with schema validation) (27.527414ms)
âœ” messenger: provider registry discovery (27.642727ms)
â–¶ workspace-path resolver
  âœ” parses ark:/ links as Arcadia links (0.529881ms)
  âœ” resolves ark:/ links using arc root (fallback to arc root) (0.259056ms)
  âœ” resolves ark:/ links using arc root and strips arcadia/ prefix (0.114659ms)
  âœ” if arc root is unavailable, ark:/ falls back to projectRoot (0.084788ms)
âœ” workspace-path resolver (1.624523ms)
â„¹ tests 122
â„¹ suites 28
â„¹ pass 114
â„¹ fail 0
â„¹ cancelled 0
â„¹ skipped 8
â„¹ todo 0
â„¹ duration_ms 33570.842716
